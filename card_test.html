<script src="js/jquery.js"></script>
<script src="lib/inheritance.js"></script>
<script src="lib/Utils.js"></script>

<style>
  html{ background : #eaeaea; }
</style>

<script>
  var opt = {
    width     : 230,
    height    : 360,
    lineWidth : 40
  };
  $(function(){
    var img = canvas_image( 'images/card-back.png' );
    $('#main').append( img );
  });
  
  function canvas_image( path ){
    var canvas  = document.createElement('canvas');
    var context = canvas.getContext('2d');
    
    canvas.width  = opt.width;
    canvas.height = opt.height;
    $(canvas).css('border', '1px solid red');
    
    var pos = [
      [ 0, 0, 0, opt.width, opt.height ],
      [ Math.PI/2, 0, -opt.height, opt.height, opt.width ],
      [ Math.PI, -opt.width, -opt.height, opt.width, opt.height ],
      [ Math.PI*3/2, -opt.width, 0, opt.height, opt.width ]
    ];
    
    var img = preload_image(path, function(){
  //    context.drawImage(this, 0, 0, this.width, this.height );
      canvas.onclick();
    });
    
    var x = 0;
    canvas.onclick = function() {
      x = (++x) % 4;
      canvas.width  = pos[x][3];
      canvas.height = pos[x][4];
      context.rotate( pos[x][0] );
      context.translate( pos[x][1], pos[x][2] );
      context.lineWidth = opt.lineWidth;
      context.moveTo( opt.width/2, 0 );
      context.quadraticCurveTo( opt.width/2, opt.height/2, opt.width, opt.height/2 );
      context.moveTo( opt.width/2, opt.height );
      context.quadraticCurveTo( opt.width/2, opt.height/2, 0, opt.height/2 );
      context.stroke();
    };
    
    return canvas;
  }
  
  function preload_image( path, callback ){
    var img     = new Image();
    img.onload  = callback;
    img.src     = path;
    return img;
  }
</script>

<body>
  <div id="main">
    
  </div>
</body>